#!/bin/bash

echo "🔄 Mise à jour du projet..."

# Fonction pour gérer les erreurs
handle_error() {
    echo "❌ Erreur: $1"
    exit 1
}

# Fonction pour mettre à jour un dépôt
update_repo() {
    local dir=$1
    echo "📂 Mise à jour de $dir..."
    
    # Vérifier si on est dans un dépôt git
    if [ ! -d ".git" ]; then
        return 0  # Skip si pas de dépôt git
    fi

    # Pull depuis main
    echo "⬇️  Récupération et fusion des modifications depuis main..."
    if ! git pull origin main --ff-only; then
        handle_error "Impossible de mettre à jour depuis main"
    fi

    echo "✅ Mise à jour terminée"
}

# Mise à jour du dépôt principal
update_repo "dépôt principal"

# Mise à jour des sous-dossiers si nécessaire
for dir in api web mobile; do
    if [ -d "$dir" ]; then
        echo "📂 Entrée dans $dir..."
        cd $dir
        update_repo "$dir"
        cd ..
    fi
done

echo "✅ Mise à jour globale terminée!" 